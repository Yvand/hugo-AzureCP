---
title: "Register an application in Azure AD"
description: ""
lead: "Register an application in your Azure Active Directory tenant and grant it the required permissions to allow AzureCP to query it."
date: 2021-05-20T10:45:06Z
lastmod: 2021-05-20T10:45:06Z
draft: false
images: []
menu: 
  docs:
    parent: "usage"
weight: 805
toc: true
---

## Prerequisites

If you are not a global administrator, you need to have permissions to [create an app registration](https://docs.microsoft.com/en-us/azure/active-directory/roles/custom-available-permissions) and to [grant it tenant-wide admin consent](https://docs.microsoft.com/en-us/azure/active-directory/roles/custom-consent-permissions#granting-permissions-to-apps-on-behalf-of-all-admin-consent) in your Azure Active Directory tenant.

## Permissions required

AzureCP needs 2 application permissions (no delegated permission):
- "Group.Read.All"
- "User.Read.All"

## Create the app registration

You can register the application using either the [Azure portal]({{< relref "#create-the-app-registration-using-the-azure-portal" >}}) or [az cli]({{< relref "#create-the-app-registration-using-az-cli" >}}).

### Create the app registration using the Azure portal

1. Sign-in to your [Azure Active Directory tenant](https://aad.portal.azure.com/).
1. Go to "App Registrations" > "New registration" > Type the following information:
    * Name: AzureCP
    * Supported account types: "Accounts in this organizational directory only (Single tenant)"
1. Click on "Register"
1. Click on "API permissions"
    * Remove the default permission.
    * Add a permission > Select "Microsoft Graph" > "Application permissions". Find and add "Group.Read.All" and "User.Read.All"
    * Click on "Grant admin consent for TenantName" > Yes
{{< alert icon="ðŸ’¡" text="After this operation, you should have only permissions \"Group.Read.All\" and \"User.Read.All\", of type \"Application\", with status \"Granted\"." >}}
1. Click on "Certificates & secrets": AzureCP supports both a certificate and a secret, choose either option depending on your needs.

### Create the app registration using az cli

This script creates the application, sets the permissions and return the client ID / client secret:

{{< alert icon="ðŸ’¡" text="This script does not work in Azure cloud shell." >}}

```bash
# Sign-in to Azure AD tenant. Use --allow-no-subscriptions only if it doesn't have a subscription
az login --allow-no-subscriptions

# Create the app for AzureCP
appName="AzureCP"
az ad app create --display-name "$appName" --key-type Password --credential-description 'client secret'
appId=$(az ad app list --display-name "$appName" --query [].appId -o tsv)
# Add API permission Group.Read.All to application (not delegated)
az ad app permission add --id $appId --api 00000003-0000-0000-c000-000000000000 --api-permissions 5b567255-7703-4780-807c-7be8301ae99b=Role
# Add API permission User.Read.All to application (not delegated)
az ad app permission add --id $appId --api 00000003-0000-0000-c000-000000000000 --api-permissions df021288-bdef-4463-88db-98f22de89214=Role
# Set a client secret generated by Azure and retrieve its value
appSecret=$(az ad app credential reset --id $appId -o tsv | cut -f3)
# Wait for 5 seconds before granting admin consent to avoid BadRequest error
sleep 5
az ad app permission admin-consent --id $appId
echo "Application $appName was created successfully with client id $appId and client secret $appSecret"
```
